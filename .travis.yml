language: node_js

env:
  - AZURE_WA_SITE=weareus-website

script:
 - npm run lint
 - npm audit
 - npm run compile

after_success:
 - rm -rf node_modules
 - npm install --production
 - mkdir deploy
 - cp -r public deploy/public
 - cp -r node_modules deploy/node_modules
 - cp -r server deploy/server
 - cp .env.example deploy
 - cp .npmrc deploy
 - cp package.json deploy
 - cp server.js deploy
 - cp web.config deploy
 - cd deploy
 - zip -r9 ../deploy.zip .
 - cd ..
 - curl -T deploy.zip -u ${SFTP_USER}:${SFTP_PASSWORD} ftps://waws-prod-dm1-095.ftp.azurewebsites.windows.net
